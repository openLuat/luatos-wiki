# ä»SXX32F103ç§»æ¤

## å‰è¨€

è¿™ç¯‡è¿ç§»æŒ‡å—æ—¨åœ¨å¸®åŠ©æ‚¨åˆ†æä»ç°æœ‰çš„SXX32F103å™¨ä»¶ç§»æ¤åˆ°AIR32F103å™¨ä»¶æ‰€éœ€çš„æ­¥éª¤ã€‚æœ¬æ–‡æ¡£æ”¶é›†äº†æœ€é‡è¦çš„ä¿¡æ¯ï¼Œå¹¶åˆ—å‡ºäº†éœ€è¦æ³¨æ„çš„é‡è¦äº‹é¡¹ã€‚

è¦å°†åº”ç”¨ç¨‹åºä»SXX32F103ç³»åˆ—ç§»æ¤åˆ°AIR32F103ç³»åˆ—ï¼Œç”¨æˆ·éœ€è¦åˆ†æç¡¬ä»¶ç§»æ¤ã€å¤–è®¾ç§»æ¤å’Œå›ºä»¶ç§»æ¤ã€‚

> AIR32F103ç³»åˆ—å¾®æ§åˆ¶å™¨åŸºæœ¬å…¼å®¹SXX32F103ç³»åˆ—ï¼ŒåŒæ—¶å¼ºåŒ–è®¸å¤šåŠŸèƒ½ï¼Œæœ‰äº›è®¸åœ°æ–¹ä¸SXX32F103ä¸åŒï¼Œè¯¦è¿°äºæœ¬æ–‡æ¡£ã€‚

## å¿«é€Ÿæ›¿æ¢ SXX32F103 èŠ¯ç‰‡

1. æ¯”å¯¹å¤–è®¾è§„æ ¼ã€Flashå®¹é‡ã€SRAMå®¹é‡ç­‰ï¼Œè§£ç„ŠSXX32F103ï¼Œæ¢æˆAIR32F103å¯¹åº”å‹å·
2. ä½¿ç”¨ISPæˆ–KEIL,ä¸‹è½½SXX32F103 HEXæ–‡ä»¶æˆ–BINæ–‡ä»¶ã€‚
3. å¦‚æœæœ‰éœ€è¦, ä¸‹è½½SXX32F103 HEXæ–‡ä»¶æˆ–BINæ–‡ä»¶ä»¥å¤–çš„èµ„æ–™æˆ–è¿›è¡Œç³»ç»Ÿæ ¡æ­£ã€‚
4. æŸ¥çœ‹ç¨‹åºèƒ½å¦æ­£å¸¸è¿è¡Œã€‚
5. å…¶ä»–é—®é¢˜å¿«é€Ÿæ’æŸ¥è¯·å‚è€ƒå¤–è®¾ä½¿ç”¨å·®åˆ«ç« èŠ‚ã€‚
6. å¦‚æœç»è¿‡ä¸Šè¿°æ­¥éª¤åç¨‹åºä»æ— æ³•æ­£å¸¸è¿è¡Œ, è¯·å‚è€ƒæœ¬æ–‡ä»¶å…¶ä»–ç« èŠ‚, æˆ–è”ç³»æ”¯æŒäººå‘˜ååŠ©è§£å†³ã€‚

## AIR32F103ç¡¬ä»¶ä½¿ç”¨å·®åˆ«

## TIM2 æ¨¡å—å¤ç”¨å·®å¼‚

AIR32F103 èŠ¯ç‰‡ TIM2 çš„ Channel1 - Channel4 è¾“å‡ºå¯å¤ç”¨å¼•è„šå’Œ SXX32F103 ä¸åŒï¼Œè¯¦ç»†å·®å¼‚å¦‚ä¸‹è¡¨ï¼š

<style>
.x21
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:1px solid windowtext;
 border-right:1px solid windowtext;
 border-bottom:1px solid windowtext;
 border-left:1px solid windowtext;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
.x22
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:1px solid windowtext;
 border-right:1px solid windowtext;
 border-bottom:1px solid windowtext;
 border-left:1px solid windowtext;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
.x23
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:1px solid windowtext;
 border-right:1px solid windowtext;
 border-bottom:1px solid windowtext;
 border-left:1px solid windowtext;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
.x24
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:1px solid windowtext;
 border-right:1px solid windowtext;
 border-bottom:1px solid windowtext;
 border-left:1px solid windowtext;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
.x25
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:1px solid windowtext;
 border-right:none;
 border-bottom:1px solid windowtext;
 border-left:1px solid windowtext;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
.x26
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:none;
 border-right:1px solid windowtext;
 border-bottom:1px solid windowtext;
 border-left:1px solid windowtext;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
.x27
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:1px solid windowtext;
 border-right:none;
 border-bottom:none;
 border-left:1px solid windowtext;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
.x28
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:1px solid windowtext;
 border-right:1px solid windowtext;
 border-bottom:none;
 border-left:none;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
.x29
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:none;
 border-right:none;
 border-bottom:1px solid windowtext;
 border-left:1px solid windowtext;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
.x30
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:none;
 border-right:1px solid windowtext;
 border-bottom:1px solid windowtext;
 border-left:none;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
.x31
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:1px solid windowtext;
 border-right:none;
 border-bottom:none;
 border-left:none;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
.x32
 {
 mso-style-parent:style0;
 mso-number-format:General;
 text-align:center;
 vertical-align:middle;
 white-space:nowrap;
 mso-pattern:auto;
 border-top:none;
 border-right:none;
 border-bottom:1px solid windowtext;
 border-left:none;
 mso-diagonal-down:none;
 mso-diagonal-up:none;
 mso-protection:locked visible;
 }
</style>
<table border='0' cellpadding='0' cellspacing='0' width='792' style='border-collapse: 
 collapse;table-layout:fixed;width:594pt'>
 <col width='111' style='mso-width-source:userset;width:83.25pt'>
 <col width='87' style='mso-width-source:userset;width:65.25pt'>
 <col width='85' style='mso-width-source:userset;width:63.75pt'>
 <col width='84' span='3' style='mso-width-source:userset;width:63pt'>
 <col width='85' span='2' style='mso-width-source:userset;width:63.75pt'>
 <col width='87' style='mso-width-source:userset;width:65.25pt'>
 <tr height='18' style='mso-height-source:userset;height:14pt' id='r0'>
<td rowspan='3' height='54' class='x25' width='111' style='border-right:1px solid windowtext;border-bottom:1px solid windowtext;height:40.5pt;width:83.25pt;'>å¤ç”¨åŠŸèƒ½</td>
<td colspan='2' class='x27' width='172'>TIM2_REMAP[1:0] = 00</td>
<td colspan='2' class='x27' width='168' style='border-right:1px solid windowtext;'>TIM2_REMAP[1:0] = 01</td>
<td colspan='2' class='x27' width='169' style='border-right:1px solid windowtext;'>TIM2_REMAP[1:0] = 10</td>
<td colspan='2' class='x27' width='172' style='border-right:1px solid windowtext;'>TIM2_REMAP[1:0] = 11</td>
 </tr>
 <tr height='18' style='mso-height-source:userset;height:14pt' id='r1'>
<td colspan='2' class='x29' style='border-bottom:1px solid windowtext;'>(æ²¡æœ‰é‡æ˜ åƒ)</td>
<td colspan='2' class='x29' style='border-right:1px solid windowtext;border-bottom:1px solid windowtext;'>(éƒ¨åˆ†é‡æ˜ åƒ)</td>
<td colspan='2' class='x29' style='border-right:1px solid windowtext;border-bottom:1px solid windowtext;'>(éƒ¨åˆ†é‡æ˜ åƒ)</td>
<td colspan='2' class='x29' style='border-right:1px solid windowtext;border-bottom:1px solid windowtext;'>(å®Œå…¨é‡æ˜ åƒ)</td>
 </tr>
 <tr height='18' style='mso-height-source:userset;height:14pt' id='r2'>
<td class='x26'>SXX32F103</td>
<td class='x26'>AIR32F103</td>
<td class='x26'>SXX32F103</td>
<td class='x26'>AIR32F103</td>
<td class='x26'>SXX32F103</td>
<td class='x26'>AIR32F103</td>
<td class='x26'>SXX32F103</td>
<td class='x26'>AIR32F103</td>
 </tr>
 <tr height='18' style='mso-height-source:userset;height:14pt' id='r3'>
<td height='16' class='x22' style='height:12.5pt;'>TIM2_CH1_ETR</td>
<td colspan='2' class='x21' style='border-right:1px solid windowtext;border-bottom:1px solid windowtext;'>PA0</td>
<td class='x22'>PA15</td>
<td class='x24'>ä¸æ”¯æŒ</td>
<td class='x22'>PA0</td>
<td class='x24'>ä¸æ”¯æŒ</td>
<td colspan='2' class='x21' style='border-right:1px solid windowtext;border-bottom:1px solid windowtext;'>PA15</td>
 </tr>
 <tr height='18' style='mso-height-source:userset;height:14pt' id='r4'>
<td height='16' class='x22' style='height:12.5pt;'>TIM2_CH2</td>
<td colspan='2' class='x21' style='border-right:1px solid windowtext;border-bottom:1px solid windowtext;'>PA1</td>
<td colspan='2' class='x21' style='border-right:1px solid windowtext;border-bottom:1px solid windowtext;'>PB3</td>
<td class='x22'>PA1</td>
<td class='x24'>ä¸æ”¯æŒ</td>
<td class='x22'>PB3</td>
<td class='x24'>ä¸æ”¯æŒ</td>
 </tr>
 <tr height='18' style='mso-height-source:userset;height:14pt' id='r5'>
<td height='16' class='x22' style='height:12.5pt;'>TIM2_CH3</td>
<td class='x22'>PA2</td>
<td class='x23'>ä¸æ”¯æŒ</td>
<td class='x22'>PA2</td>
<td class='x24'>ä¸æ”¯æŒ</td>
<td class='x22'>PB10</td>
<td class='x24'>ä¸æ”¯æŒ</td>
<td class='x22'>PB10</td>
<td class='x24'>ä¸æ”¯æŒ</td>
 </tr>
 <tr height='18' style='mso-height-source:userset;height:14pt' id='r6'>
<td height='16' class='x22' style='height:12.5pt;'>TIM2_CH4</td>
<td colspan='4' class='x21' style='border-right:1px solid windowtext;border-bottom:1px solid windowtext;'>PA3</td>
<td colspan='4' class='x21' style='border-right:1px solid windowtext;border-bottom:1px solid windowtext;'>PB11</td>
 </tr>
<![if supportMisalignedColumns]>
 <tr height='0' style='display:none'>
  <td width='111' style='width:83.25pt'></td>
  <td width='87' style='width:65.25pt'></td>
  <td width='85' style='width:63.75pt'></td>
  <td width='84' style='width:63pt'></td>
  <td width='84' style='width:63pt'></td>
  <td width='84' style='width:63pt'></td>
  <td width='85' style='width:63.75pt'></td>
  <td width='85' style='width:63.75pt'></td>
  <td width='87' style='width:65.25pt'></td>
 </tr>
 <![endif]>
</table>

## GPIO å¼•è„šè€å‹è¯´æ˜

AIR32F103 çš„ PA11ã€PA12 å¼•è„šè€å‹ä¸Šé™ä¸º 3.6Vï¼Œç¡¬ä»¶ç”µè·¯è®¾è®¡æ—¶æ³¨æ„ç”µå‹èŒƒå›´ã€‚

- PA11 å¼•è„šå¯é€‰å¤ç”¨åŠŸèƒ½ä¸º CAN_RXã€USART1_CTSã€USBDMã€TIM1_CH4
- PA12 å¼•è„šå¯é€‰å¤ç”¨åŠŸèƒ½ä¸º CAN_TXã€USART1_RTSã€USBDPã€TIM1_ETR

## è‡ªä¸¾æ¨¡å¼é€‰æ‹©å¼•è„š

BOOT0 ç®¡è„šæ‚¬ç©ºæ—¶ï¼Œä¸ºæµ®ç©ºçŠ¶æ€ï¼ŒèŠ¯ç‰‡å¤ä½å¯åŠ¨åæœ‰æ¦‚ç‡ä»é Flash åŒºåŸŸå¼€å¯æ‰§è¡Œç¨‹åºã€‚è‹¥éœ€ä»ç”¨æˆ· Flash å¯åŠ¨ï¼Œè¯·é¿å… BOOT0 å‡ºç°æ‚¬ç©ºæƒ…å†µ

**æ¨è BOOT0 å¼•è„šå¤–æ¥ 10K ä¸‹æ‹‰ç”µé˜»æˆ–ç›´æ¥æ¥åœ°**ï¼Œå¯ä»¥ç¨³å®šä»ç”¨æˆ· Flash å¯åŠ¨ã€‚

|BOOT1|BOOT0|è‡ªä¸¾æ¨¡å¼|åˆ«åä½¿ç”¨|
|:-:|:-:|:-:|:-:|
|X|0|ç”¨æˆ· Flash|é€‰æ‹©ç”¨æˆ· Flash ä½œä¸ºè‡ªä¸¾ç©ºé—´|
|0|1|ç³»ç»Ÿå­˜å‚¨å™¨|é€‰æ‹©ç³»ç»Ÿå­˜å‚¨å™¨ä½œä¸ºè‡ªä¸¾ç©ºé—´|
|1|1|åµŒå…¥å¼ SRAM|é€‰æ‹©åµŒå…¥å¼ SRAM ä½œä¸ºè‡ªä¸¾ç©ºé—´|

## AIR32F103è½¯ä»¶ä½¿ç”¨å·®åˆ«

## ç³»ç»ŸåŠŸèƒ½

### é…ç½®DEBUGçŠ¶æ€ï¼Œä½¿èƒ½SWï¼Œå…³æ–­JTAGå·®å¼‚

é…ç½®DEBUGçŠ¶æ€ï¼Œå°†SWä½¿èƒ½ï¼ŒJTAGå…³æ–­ï¼Œå¦‚ä¸‹å›¾ä½¿ç”¨

```c
GPIO_PinRemapConfig(GPIO_Remap_SWJJTAGDISABLE, ENABLE);
```

SXX32F103ï¼šJTAGå…³æ–­ï¼Œæ­£å¸¸ä½¿ç”¨SW è¿›è¡ŒDEBUG

AIR32F103ï¼šç¨‹åºå¤ä½ã€‚Air32ä»…æ”¯æŒ**å®Œå…¨å…³é—­SWDä¸JTAGåŠŸèƒ½**ä¸**åŒæ—¶å¼€å¯SWDä¸JTAGåŠŸèƒ½**ä¸¤ç§è®¾ç½®

ä¼šå¯¼è‡´çš„ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚åœ¨cubemxé…ç½®ä¸ºSWè°ƒè¯•ï¼Œä¸‹è½½ä¸€æ¬¡å›ºä»¶ä»¥åå°±è¿æ¥ä¸ä¸Šè®¾å¤‡äº†ï¼Œè§£å†³æ–¹æ³•æ˜¯åœ¨`sxx32f1xx_hal_msp.c`æ–‡ä»¶çš„`HAL_MspInit`å‡½æ•°åŠ å…¥`__HAL_AFIO_REMAP_SWJ_ENABLE();`

```c
/* USER CODE END 0 */
/**
  * Initializes the Global MSP.
  */
void HAL_MspInit (void)
{
    /* USER CODE BEGIN MspInit 0 */

    /* USER CODE END MspInit 0 */

    __HAL_RCC_AFIO_CLK_ENABLE();
    __HAL_RCC_PWR_CLK_ENABLE();

    /* System interrupt init */

    /** NOJTAG:. JTAG-DP Disabled and SW-DP Enabled
    */
    __HAL_AFIO_REMAP_SWJ_NOJTAG();

    /* USER CODE BEGIN MspInit 1 */
    __HAL_AFIO_REMAP_SWJ_ENABLE();
    /* USER CODE END MspInit 0 */
}
/* USER CODE BEGIN 1 */
```

### ä»¿çœŸçŠ¶æ€ä¸‹å°† JTAG å…³æ–­æˆ–è€…å°† JTRST é‡Šæ”¾ä¼šå¯¼è‡´å¤ä½

ä»¿çœŸçŠ¶æ€ä¸‹ï¼Œå°† JTAG å…³æ–­æˆ–è€…å°† JTRST é‡Šæ”¾ï¼Œä¼šå¯¼è‡´èŠ¯ç‰‡ç«‹åˆ»å¤ä½ï¼Œæ— æ³•æ‰§è¡Œåç»­ä»£ç ã€‚

è§£å†³æ–¹æ¡ˆï¼š

- ä»¿çœŸçŠ¶æ€ä¸‹ï¼Œä¸è¦æ‰§è¡Œ JTAG å…³æ–­æˆ–è€…å°† JTRST é‡Šæ”¾çš„ä»£ç 
- éä»¿çœŸçŠ¶æ€ä¸‹ï¼ŒJTAG å…³æ–­å’Œ JTRST é‡Šæ”¾åŠŸèƒ½æ­£å¸¸ï¼Œä¸å½±å“ç¨‹åºè¿è¡Œã€‚

### è½¯å¤ä½æ—¶ä¸ä¼šé‡æ–°åŠ è½½è‡ªä¸¾æ¨¡å¼çš„é…ç½®é€‰é¡¹

å¼‚å¸¸æƒ…å†µä¸¾ä¾‹ï¼ˆé€šè¿‡ ISP å¼€å¯è¯»/å†™ä¿æŠ¤ï¼‰ï¼š

- BOOT0 æ¥é«˜ï¼ŒBOOT1 æ¥ä½ï¼Œå¤–éƒ¨ Resetï¼Œä½¿ç”¨ ISP æˆåŠŸè¿æ¥
- å°† BOOT0 ä¿®æ”¹ä¸ºæ¥ä½ï¼Œé€šè¿‡ ISP å¼€å¯è¯»/å†™ä¿æŠ¤
- è¯»/å†™ä¿æŠ¤æˆåŠŸå¼€å¯åå‘ç° Flash ä¸­ç¨‹åºæ²¡æœ‰æ‰§è¡Œ

é—®é¢˜åŸå› ï¼š

é€šè¿‡ ISP å¼€å¯è¯»/å†™ä¿æŠ¤åèŠ¯ç‰‡ä¼šè‡ªåŠ¨å‘èµ·ç³»ç»Ÿå¤ä½ï¼Œç”±äºè½¯å¤ä½æ—¶ä¸ä¼šé‡æ–°åŠ è½½è‡ªä¸¾æ¨¡å¼çš„é…ç½®ç®¡è„šï¼Œè¿˜ä¼šä¿æŒä¸Šä¸€æ¬¡ BOOT ç®¡è„šçš„é…ç½®çŠ¶æ€ï¼Œæ‰€ä»¥åˆè¿›å…¥äº†ç³»ç»Ÿå­˜å‚¨å™¨æ‰§è¡Œç¨‹åºï¼Œå¯¼è‡´ Flash ä¸­ç¨‹åºæ²¡æœ‰æ‰§è¡Œã€‚

è§£å†³æ–¹æ¡ˆï¼š

è‡ªä¸¾æ¨¡å¼ä¿®æ”¹åï¼Œé€šè¿‡å¤–éƒ¨ RESET å¤ä½ï¼Œæˆ–è€…é‡æ–°ä¸Šä¸‹ç”µçš„æ–¹å¼å¯¹èŠ¯ç‰‡è¿›è¡Œå¤ä½ã€‚

### ä¸æ”¯æŒæŸäº›SXX32F103ä¸“ç”¨çƒ§å½•å™¨ä¸‹è½½

AIR32F103å’ŒSXX32F103 ARM M3 Coreç‰ˆæœ¬ã€SWã€JTAG IDCODEä¸åŒ

|èŠ¯ç‰‡|SXX32F103|AIR32F103|
|:-:|:-:|:-:|
|Core ID|0x411FC231|0x412FC230|
|SW IDCODE|0x1BA01477|0x2BA01477|
|JTAG IDCODE|0x3BA00477|0x4BA00477|

å½“ä½¿ç”¨æŸäº›SXX32F103ä¸“ç”¨çƒ§å½•å™¨æ—¶ï¼Œä¼šåˆ¤æ–­Core IDå’ŒSW IDCODEã€JTAG IDCODEç­‰ä¿¡æ¯ï¼Œæ•…ä¸æ”¯æŒæŸäº›SXX32F103ä¸“ç”¨çƒ§å½•å™¨

è§£å†³æ–¹æ³•ï¼š

ä½¿ç”¨ä¸åˆ¤æ–­Core IDå’ŒSW IDCODEã€JTAG IDCODEçš„çƒ§å½•å™¨

### ç¬¬ä¸‰æ–¹æŸäº›çƒ§å½•å™¨ä¸‹è½½å¤±è´¥é—®é¢˜

å¯¹äºæŸäº›çƒ§å½•å™¨åœ¨RESETæ‹‰ä½çš„æƒ…å†µä¸‹è¿›è¡ŒSW/JTAGäº¤äº’ï¼Œæ˜¯ä¸æ”¯æŒçš„ã€‚å› ä¸ºAIR32F103å½“RESETæ‹‰ä½æ—¶ï¼ŒSWå’ŒJTAGæ˜¯æ— æ³•ä½¿ç”¨çš„ï¼ˆå¦‚ï¼šWizPro200ST8ç¼–ç¨‹å™¨ï¼‰

è§£å†³æ–¹æ³•ï¼š

1. é…ç½®çƒ§å½•å™¨ï¼Œåœ¨çƒ§å½•æ—¶å°†RESETæ‹‰é«˜
2. æ‚¬ç©ºèŠ¯ç‰‡NRSTç®¡è„šï¼Œä¸å’Œçƒ§å½•å™¨ç›¸è¿

### é32bitå¯¹é½è®¿é—®APBæ€»çº¿æ—¶ï¼Œç°è±¡å·®å¼‚

è®¿é—®APBæ€»çº¿æ—¶ï¼Œå¿…é¡»32bitå¯¹é½ï¼Œå¦åˆ™æ— æ³•è®¿é—®ï¼Œå¦‚ï¼š

ADC é…ç½®ä¸ºå·¦å¯¹é½æ¨¡å¼æ—¶ï¼Œä» 0x4001244E åœ°å€è·å–è½¬åŒ–å®Œçš„é«˜ 8bit æ•°æ®ï¼Œå‘ç°è·å–åˆ°çš„æ•°å€¼å›ºå®šä¸º 0

è§£å†³æ–¹æ³•ï¼š

è®¿é—® APB æ€»çº¿çš„å¯„å­˜å™¨æ—¶ï¼Œéœ€è¦æŒ‰ç…§ 32bit å¯¹é½ã€‚è‹¥éœ€è¦ 32bit å¯„å­˜å™¨ä¸­æŸä¸€å­—æ®µï¼Œ32bit å¯¹é½è¯»å‡ºåå†è¿›è¡Œå¤„ç†

### ä¸­æ–­æ§åˆ¶å™¨å·®å¼‚

SXX32F103ï¼š

1. æœ€å¤šæ”¯æŒ60ä¸ªå¯å±è”½ä¸­æ–­é€šé“
2. 16ä¸ªå¯ç¼–ç¨‹çš„ä¼˜å…ˆç­‰çº§(ä½¿ç”¨äº†4ä½ä¸­æ–­ä¼˜å…ˆçº§)

AIR32F103ï¼š

1. æœ€å¤šæ”¯æŒ71ä¸ªå¯å±è”½ä¸­æ–­é€šé“
2. 8ä¸ªå¯ç¼–ç¨‹çš„ä¼˜å…ˆç­‰çº§(ä½¿ç”¨äº†3ä½ä¸­æ–­ä¼˜å…ˆçº§)

ä¼šå¯¼è‡´çš„é—®é¢˜ï¼š

cubemxæˆ–è€…å…¶ä»–freertoså·¥ç¨‹çš„`configPRIO_BITS`è®¾ç½®æ˜¯4ï¼Œéœ€è¦æ”¹æˆ3ï¼Œä¸ç„¶ä¼šå¯¼è‡´å¼‚å¸¸ï¼Œæ³¨æ„å¦‚æœæ˜¯cubemxä¼šå¯¼è‡´æ¯æ¬¡ç”Ÿæˆä»£ç ä»¥åéƒ½è¦é‡æ–°è®¾ç½®ï¼Œæ‰€ä»¥å¯ç”¨ç›´æ¥æ³¨é‡Šæ‰`FreeRTOSConfig.h`é‡Œçš„è¿™å¥è¯

```c
/* USER CODE BEGIN 1 */
// #define configASSERT( x ) if ((x) == 0) {taskDISABLE_INTERRUPTS(); for( ;; );}
/* USER CODE END 1 */
```

å¯ä»¥æŸ¥çœ‹ARMçš„æ‰‹å†Œï¼Œ3ä½ä¸­æ–­ä¼˜å…ˆçº§å’Œ4ä½å…¼å®¹ï¼Œä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼Œcubemxä¸­çš„configASSERTé…ç½®å®é™…å¾ˆå½±å“è¿è¡Œæ•ˆç‡ï¼Œfreertosçš„æ‰‹å†Œä¸­å»ºè®®å…³é—­ã€‚æ‰€ä»¥æŒ‰è¿™ä¸ªæ–¹æ¡ˆä¿®æ”¹ä¸ä¼šæœ‰ä»»ä½•bugï¼Œæ— éœ€æ‹…å¿ƒã€‚

![image-20220623095717980](img/image-20220623095717980.png)

### åŒºåˆ† Air32 èŠ¯ç‰‡å’Œ SXX32F103 èŠ¯ç‰‡çš„æ–¹æ³•

è¯»å–åŸºåœ°å€ 0x1FFFF7E8ï¼Œè·å– 32bit æ ‡è¯†è¿›è¡ŒåŒºåˆ†ã€‚

|å‹å·|å‹å·æ ‡è¯†|
|:-:|:-:|
|AIR32F103CBT6|0x1A5A5BBX|
|AIR32F103CCT6|0x1A5A5CCX|
|AIR32F103RPT6|0x1A6A5CDX|
|AIR32F103VET6|0x1A8A6DDX|
|AIR32F103VGT6|0x1A8A6EDX|
|AIR32F103ZET6|0x1A9A6DDX|

### è½¯ä»¶å»¶æ—¶å·®å¼‚

ä½¿ç”¨å…¶ä»–å¹³å°å®ç°çš„ä¸€äº›è½¯ä»¶å»¶æ—¶éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚ä¸‹å›¾ç®€å•è½¯ä»¶å»¶æ—¶å‡½æ•°

```c
void delay()
{
    uint8_t i = 100;
    while(i--);
}
```

- SXX32F103 æ‰§è¡Œè¯¥å‡½æ•°çš„å»¶æ—¶æ—¶é—´æ˜¯ 10us
- AIR32F103 æ‰§è¡Œè¯¥å‡½æ•°çš„å»¶æ—¶æ—¶é—´æ˜¯ 7.2us

å¦‚æœåº”ç”¨ä¸­å¯¹è½¯ä»¶å»¶æ—¶æ—¶é—´è¦æ±‚æ¯”è¾ƒä¸¥æ ¼ï¼Œè¯·å¯¹è½¯ä»¶å®ç°çš„å»¶æ—¶å‚æ•°åšä¸€å®šçš„è°ƒæ•´

### RTCæ—¶é’Ÿï¼Œé¢„åˆ†é¢‘è£…è½½å€¼è¶…è¿‡0xffffæ—¶ï¼Œç®—æ³•çš„å·®å¼‚

Air32çš„RTCå†…éƒ¨çš„åˆ†é¢‘=(PRLH+1)*(PRLL+1)ï¼Œä¸SXX32ä¸åŒ

ä¾‹å¦‚ï¼Œ16Mæ™¶æŒ¯ï¼Œé…ç½®RTCæ—¶é’ŸHSE 128åˆ†é¢‘ï¼Œæ—¶é—´å•ä½ä¸º1ç§’ï¼š

- SXX32F103 ä½¿ç”¨`RTC_SetPrescaler(124999);`
- AIR32F103 ä½¿ç”¨`RTC_SetPrescaler(227857);`ï¼ˆæˆ–`RTC_SetPrescaler(128035);`ï¼‰

16000000 / 128 = 125000ï¼›ä¸€å…±20bitï¼Œé«˜å››ä½æ˜¯3çš„è¯ï¼Œä½16ä½æ˜¯125000 / ï¼ˆ3 + 1ï¼‰ - 1 = 31249ï¼Œåˆèµ·æ¥227857

### TRACESWO ä½œä¸º Printf åŠŸèƒ½ä½¿ç”¨è¯´æ˜

ä½¿ç”¨ TRACESWO ç®¡è„š(PB3)ä½œä¸º Log è¾“å‡ºï¼Œå‘ç°å¹¶æ—  Log æ­£å¸¸è¾“å‡º

é—®é¢˜åŸå› ï¼š

AIR32F103 PB3 ä½œä¸º JTDO åŠŸèƒ½çš„ä¼˜å…ˆçº§è¦é«˜äº TRACESWO åŠŸèƒ½ã€‚

è§£å†³æ–¹æ¡ˆï¼š

ä½¿ç”¨ TRACESWO ç®¡è„š(PB3)ä½œä¸º Log è¾“å‡ºï¼Œéœ€è¦é…ç½® JTAG å¤ç”¨ã€‚å¦‚ä¸‹ï¼š

```c
RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO,ENABLE);
GPIO_PinRemapConfig(GPIO_Remap_SWJ_JTAGDisable,ENABLE);
```

### å¼€å¯è¯»ä¿æŠ¤åè‡ªåŠ¨å¼€å¯å†™ä¿æŠ¤åŒºåŸŸå¤§å°è¯´æ˜

å¼€å¯è¯»ä¿æŠ¤åï¼Œè‡ªåŠ¨å¼€å¯å†™ä¿æŠ¤åŒºåŸŸå¤§å°è¯´æ˜å¦‚ä¸‹ï¼š

|     å‹å·      | å†™ä¿æŠ¤åŒºåŸŸå¤§å° |
| :-----------: | :------------: |
| AIR32F103CBT6 |       8K       |
| AIR32F103CCT6 |       4K       |
| AIR32F103RPT6 |       4K       |
| AIR32F103VET6 |       4K       |
| AIR32F103VGT6 |       4K       |
| AIR32F103ZET6 |       4K       |
| AIR32F103ZGT6 |       4K       |



## ADC

### é…ç½® ADC è¿ç»­é‡‡æ ·ä¸”ä½¿èƒ½ ADC åï¼Œåªå…³é—­ ADC ä½¿èƒ½æ— æ³•åœæ­¢è½¬åŒ–

å¤ç°é—®é¢˜æ­¥éª¤å¦‚ä¸‹ï¼š

- é…ç½® ADC ä¸ºè¿ç»­é‡‡æ ·æ¨¡å¼ï¼ˆè¿ç»­è§¦å‘æ¨¡å¼ï¼‰ï¼Œå¼€å¯ DMA æ¬è¿ã€‚è½¯ä»¶è§¦å‘å ADC æ¯è½¬åŒ–å®Œæˆä¸€æ¬¡ï¼ŒDMA æ¬è¿ä¸€æ¬¡ï¼Œè¿›ä¸€æ¬¡ DMA å®Œæˆä¸­æ–­
- åœ¨ DMA å®Œæˆä¸­æ–­ä¸­é…ç½®å…³é—­ ADC ä½¿èƒ½
- AIR32F103 åœ¨å…³é—­ ADC ä½¿èƒ½åï¼ŒADC è¿˜ä¼šæŒç»­è½¬åŒ–ï¼Œè¿˜ä¼šæŒç»­è¿› DMA å®Œæˆä¸­æ–­

è§£å†³æ–¹æ¡ˆï¼š

é…ç½® ADC ä¸ºå•æ¬¡è½¬åŒ–å¹¶ä¸”ç­‰å¾…ä¸Šä¸€æ¬¡é‡‡æ ·å‘¨æœŸä¸ª ADC_CLK åï¼Œå†å…³é—­ ADC ä½¿èƒ½

å¦‚ï¼Œä¾‹å­é…ç½®çš„ ADC æ—¶é’Ÿä¸º 9Mï¼Œé‡‡æ ·å‘¨æœŸä¸º 239.5ï¼Œæ‰€ä»¥ç­‰å¾…çš„æ—¶é—´ä¸º(239.5+12.5)*1/9000 â‰ˆ 27.922usï¼Œæ•…ä»¥ä¸‹ä»£ç ç­‰å¾… 30us æ˜¯è¶³å¤Ÿçš„

```c
void DMA1_Channel1_IRQHandler(void)
{
    if(DMA_GetITStatus(DMA1_IT_TC1) != RESET)
    {
        DMA_ClearITPendingBit(DMA1_IT_TC1);
        DMA_ClearFlag(DMA1_IT_TC1);

        //å¤„ç†ç”µæµæ•°æ®

        ADC1->CR2 &= ~BIT(1); // é…ç½®adcä¸ºå•æ¬¡è½¬åŒ–
        Delay_Us(30);   //ç­‰å¾…30us
        ADC_Cmd(ADC1, DISABLE); //å…³é—­ADCä½¿èƒ½
    }
}
```

### ADC è¿ç»­ä¸¤æ¬¡ä½¿èƒ½ ADON å†è¿›è¡Œå¤–éƒ¨äº‹ä»¶çš„è½¯ä»¶è§¦å‘æ³¨æ„äº‹é¡¹

```c
ADC_Cmd(ADC1, ENABLE);
ADC_Cmd(ADC1, ENABLE);
ADC_SoftwareStartConvCmd(ADC1, ENABLE);
```

ä»¥ä¸Šæ“ä½œï¼ŒAIR32F103 ä¼šå‡ºç° EOC ç½®ä½åæ— æ³•æ¸… 0ï¼Œå¹¶ä¸” ADC è½¬åŒ–å€¼å¼‚å¸¸ç°è±¡

è§£å†³æ–¹æ¡ˆï¼š

ä½¿èƒ½ ADC åï¼Œå†æ¬¡ä½¿èƒ½ ADCï¼Œç­‰å¾… EOC ç½®ä½ï¼Œè¯»å–é‡åŒ–å€¼ï¼Œå¦‚ä¸‹

```c
ADC_Cmd(ADC1, ENABLE);
ADC_Cmd(ADC1, ENABLE);
while(ADC_GETFlagStatus(ADC1,ADC_Flag_EOC) == RESET);
ADC_GetConversionValue(ADC1);
ADC_SoftwareStartConvCmd(ADC1, ENABLE);
```

æ³¨æ„ï¼š

å½“ ADC ä½¿èƒ½åï¼Œå†æ¬¡ä½¿èƒ½ ADCï¼ŒSXX32F103 å’Œ AIR32F103 å‡ä¼šè§¦å‘ä¸€æ¬¡ ADC è½¬åŒ–ã€‚

### ADCè¿ç»­ä¸¤æ¬¡ä½¿èƒ½å¤–éƒ¨äº‹ä»¶çš„è½¯ä»¶è§¦å‘æ³¨æ„äº‹é¡¹

```c
ADC_SoftwareStartConvCmd(ADC1, ENABLE);
ADC_SoftwareStartConvCmd(ADC1, ENABLE);
```

ä»¥ä¸Šæ“ä½œï¼ŒAIR32F103 ä¼šå‡ºç° EOC ç½®ä½åæ— æ³•æ¸… 0ï¼Œå¹¶ä¸” ADC è½¬åŒ–å€¼å¼‚å¸¸ç°è±¡

è§£å†³æ–¹æ³•ï¼š

å¤–éƒ¨äº‹ä»¶çš„è½¯ä»¶è§¦å‘ï¼Œç­‰å¾… EOC ç½®ä½ï¼Œè¯»å–é‡åŒ–å€¼

```c
ADC_SoftwareStartConvCmd(ADC1, ENABLE);
while(ADC_GETFlagStatus(ADC1, ADC_FLAG_EOC) == RESET);
ADCGetConversionValue(ADC1);
ADC_SoftwareStartConvCmd(ADC1, ENABLE);
while(ADC_GETFlagStatus(ADC1, ADC_FLAG_EOC) == RESET);
ADCGetConversionValue(ADC1);
```

### åŒ ADC ä¸åŒæ¨¡å¼å·®å¼‚

åŒæ­¥æ³¨å…¥ã€äº¤æ›¿è§¦å‘æ¨¡å¼ä¸‹ï¼š

- SXX32F103ï¼šæ³¨å…¥ç»„é€šé“/è§„åˆ™ç»„é€šé“è¢«è§¦å‘åï¼Œå‡æ­£å¸¸è½¬åŒ–
- AIR32F103ï¼šæ³¨å…¥ç»„é€šé“è¢«è§¦å‘åï¼Œæ­£å¸¸è½¬åŒ–ï¼›è§„åˆ™ç»„é€šé“è¢«è§¦å‘åï¼Œä¸è¿›è¡Œè½¬åŒ–

åŒæ­¥è§„åˆ™ã€å¿«é€Ÿäº¤å‰ã€æ…¢é€Ÿäº¤å‰æ¨¡å¼ä¸‹ï¼š

- SXX32F103ï¼šæ³¨å…¥ç»„é€šé“/è§„åˆ™ç»„é€šé“è¢«è§¦å‘åï¼Œå‡æ­£å¸¸è½¬åŒ–
- AIR32F103ï¼šè§„åˆ™ç»„é€šé“è¢«è§¦å‘åï¼Œæ­£å¸¸è½¬åŒ–ï¼›æ³¨å…¥ç»„é€šé“è¢«è§¦å‘åï¼Œä¸è¿›è¡Œè½¬åŒ–

### ADC å’Œ DMA é…ç½®ä½¿ç”¨æ³¨æ„äº‹é¡¹

é—®é¢˜æè¿°ï¼š

é…ç½®ADCè¿ç»­é‡‡æ ·å¤šä¸ªé€šé“ä¸”ä½¿ç”¨ DMAæ¬è¿æ•°æ®æ—¶ï¼Œå‡ºç°ADC é‡åŒ–å€¼å‡ºé”™(é”™ä½)ç°è±¡ã€‚  
ä¾‹å¦‚è½¬åŒ– 5 ä¸ªé€šé“ï¼Œé…ç½®ä¸ºè§„åˆ™ç»„ï¼Œè¿ç»­æ‰«æè½¬æ¢  
æœŸæœ›å€¼ä¸º{0V,1V,1.5V,2V,2.5V, 0V,1V,1.5V,2V,2.5V, 0V,1V,1.5V,2V,2.5V â€¦}  
å®é™…è½¯ä»¶è·å–çš„å€¼ä¸º{1.5V,2V,2,5V,0V,1V, 1.5V,2V,2,5V,0V,1V, 1.5V,2V,2,5V,0V,1V â€¦}  

è§£å†³æ–¹æ¡ˆï¼š

å…ˆé…ç½® DMAï¼Œå†ä½¿èƒ½ ADCï¼Œåˆ™ä¸ä¼šå‡ºç° ADC é‡åŒ–å€¼å‡ºé”™(é”™ä½)é—®é¢˜

### ADCä½¿ç”¨ADCè‡ªåŠ¨æ³¨å…¥è½¬æ¢å·®å¼‚

SXX32F103ï¼šADCè‡ªåŠ¨æ³¨å…¥è½¬æ¢ç›´æ¥ä½¿ç”¨

AIR32F103ï¼šADCè‡ªåŠ¨æ³¨å…¥è½¬æ¢è·å–åˆ°å€¼ä¸º0

è§£å†³æ–¹æ³•ï¼šAIR32F103ä½¿ç”¨è‡ªåŠ¨æ³¨å…¥è½¬æ¢ADC_ScanConvModeéœ€è¦é…ç½®ä¸ºå¼€å¯

```c
ADC_InitStructure.ADC_ScanConvMode = ENABLE;
```

## TIM

### é€šç”¨å®šæ—¶å™¨ TIM2 - TIM5 çš„ Channel3 ä¸æ”¯æŒæ¯”è¾ƒè¾“å‡ºåŠŸèƒ½

AIR32F103 é€šç”¨å®šæ—¶å™¨ TIM2-TIM5 çš„ Channel3 ä¸æ”¯æŒæ¯”è¾ƒè¾“å‡ºåŠŸèƒ½ï¼Œä»…æ”¯æŒæ•è·è¾“å…¥åŠŸèƒ½

è§£å†³æ–¹æ³•ï¼š

é€‰æ‹© TIM2-TIM5 çš„å…¶ä»–é€šé“,æˆ–è€…é€‰æ‹©å…¶ä»– TIM çš„é€šé“è¿›è¡Œè¾“å‡ºä½¿ç”¨

### è¿ç»­ä¸¤æ¬¡åˆ¹è½¦çš„æ—¶é—´é—´éš”å°äºä¸€ä¸ª TIM æ—¶é’Ÿå‘¨æœŸæ—¶ BIF æ— æ³•æ¸…é›¶

å½“è¿ç»­ä¸¤æ¬¡åˆ¹è½¦çš„æ—¶é—´é—´éš”å°äºä¸€ä¸ª TIM æ—¶é’Ÿå‘¨æœŸæ—¶ï¼Œä¼šå‡ºç° BIF(åˆ¹è½¦ä¸­æ–­æ ‡è®°)ç½® 1 åï¼Œæ— æ³•æ¸… 0 ç°è±¡

è§£å†³æ–¹æ³•ï¼ˆäºŒé€‰ä¸€ï¼‰ï¼š

1. è½¯ä»¶é…ç½®åˆ¹è½¦ä¿¡å·ä¸ºæ™®é€šè¾“å…¥IOä¸­æ–­ï¼Œä¸ä½¿ç”¨ BIFå’Œåˆ¹è½¦ä¸­æ–­
2. åœ¨BIFå†…ç½®1ï¼Œè¿›è¡Œè½¯å¤ä½TIM

### è½¯ä»¶ä¿®æ”¹ CNT å€¼å TIM æ²¡æœ‰é‡æ–°é…ç½® CNT è¿›è¡Œè®¡æ•°

æŸäº›æƒ…å†µä¸‹è½¯ä»¶ä¿®æ”¹ CNT å€¼åï¼ŒTIM å¹¶æœªé‡æ–°é…ç½®çš„ CNT è¿›è¡Œè®¡æ•°

æ¡ˆä¾‹1ï¼š

1ï¼TIM é…ç½®ä¸ºå•è„‰å†²æ¨¡å¼å¹¶å¼€å¯æ›´æ–°ä¸­æ–­

```c
TIM_SelectOnePulseMode(TIMx, TIM_OPMode_Single); //é…ç½®ä¸ºå•è„‰å†²æ¨¡å¼
TIM_ITConfig(TIMx, TIM_IT_Update, ENABLE);
TIM_Cmd (TIMx, ENABLE);
```

2ï¼åœ¨æ›´æ–°ä¸­æ–­ä¸­é…ç½®CNTï¼Œä½¿èƒ½CEN

```c
if (TIM_GetITStatus(TIMx, TIM_IT_Update) != RESET)
{
    TIM_ClearITPendingBit(TIMx, TIM_IT_Update);
    TIM_SetCounter(TIMx, NewCnt); //è½¯ä»¶é…ç½®CNTå€¼
    TIM_Cmd(TIMx, ENABLE);  //è¯•èƒ½TIM
}
```

æ³¨æ„ï¼š
å•è„‰å†²æ¨¡å¼ä¸‹ï¼ŒSXX32F103 å’Œ AIR32F103 çš„ TIM è®¡æ•°å™¨è‡ªåŠ¨åœ¨äº§ç”Ÿä¸‹ä¸€ä¸ªæ›´æ–°äº‹ä»¶ UEVæ—¶åœæ­¢

æ¡ˆä¾‹2ï¼š

- TIM ä¸é…ç½®å•è„‰å†²æ¨¡å¼
- åœ¨ä¸­æ–­ä¸­è½¯ä»¶å…³é—­ TIMï¼Œä¿®æ”¹ CNT å€¼ï¼Œè½¯ä»¶å†ä½¿èƒ½ TIM

```c
void TIM3_IRQHandler(void)
{
    if(TIM_GetITStatus(TIMx,TIM_IT_Update) != RESET)
    {
        TIM_Cmd(TIMx, DISABLE);
        TIM_ClearITPendingBit(TIMx, TIM_IT_Update);
        TIM_SetCounter(TIMx, 1999);
        TIM_Cmd(TIMx, ENABLE);
    }
}
```

é—®é¢˜åŸå› ï¼š

åªæœ‰ CEN å¤„äºä½¿èƒ½çŠ¶æ€æ—¶ï¼Œè½¯ä»¶ä¿®æ”¹ CNT æ‰ç”Ÿæ•ˆ

è§£å†³æ–¹æ¡ˆï¼š

- è‹¥é…ç½®ä¸ºå•è„‰å†²æ¨¡å¼æ—¶äº§ç”Ÿæ›´æ–°äº‹ä»¶åï¼Œè‹¥éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ CNT å€¼ï¼Œåº”å½“å…ˆä½¿èƒ½ TIMå†ä¿®æ”¹
- è‹¥æ²¡æœ‰é…ç½®å•è„‰å†²æ¨¡å¼ï¼Œæ‰‹åŠ¨ä¿®æ”¹ CNT å€¼æ—¶ä¸è¦å°† TIM å…³é—­

## CAN

### ä¼‘çœ æ¨¡å¼ä¸‹é…ç½®è¿‡æ»¤å™¨æ³¨æ„äº‹é¡¹

é—®é¢˜æè¿°ï¼š

CAN æ¨¡å—å…ˆåˆå§‹åŒ–è¿‡æ»¤å™¨ï¼Œå†åˆå§‹åŒ–æ§åˆ¶å™¨ï¼Œå¯¼è‡´å¯ä»¥å‘é€æ•°æ®ï¼Œæ— æ³•æ¥æ”¶æ•°æ®çš„ç°è±¡

é—®é¢˜åŸå› ï¼š

AIR32F103 é…ç½® CAN è¿‡æ»¤å™¨æ—¶ï¼Œéœ€è¦ç¡®ä¿ CAN å¤„äºéä¼‘çœ æ¨¡å¼

è§£å†³æ–¹æ¡ˆï¼š

å…ˆåˆå§‹åŒ– CAN æ§åˆ¶å™¨ï¼Œå†é…ç½®è¿‡æ»¤å™¨å¯è§£å†³

### CANå‘é€æ—¶é—´æˆ³æ—¶ï¼Œæ—¶é—´æˆ³å¡«å……æŠ¥æ–‡çš„ä½ç½®å·®å¼‚

CANé…ç½®æ—¶é—´è§¦å‘é€šè®¯æ¨¡å¼ï¼Œåœ¨æœ€å2ä¸ªæ•°æ®å­—èŠ‚å‘é€æ—¶é—´æˆ³æ—¶  
ç”±äºè®¾è®¡ä¸åŒï¼ŒAIR32F103 ä½¿ç”¨ CAN å‘é€æ—¶é—´æˆ³ï¼ŒCAN_TDTxR å¯„å­˜å™¨ä¸­ TIME[15:0]å­—æ®µå¡«å……æŠ¥æ–‡ä½ç½®å’Œ SXX32F103 ä¸åŒ

SXX32F103ï¼šTIME[7:0] ä½œä¸ºç¬¬ 7 ä¸ªå­—èŠ‚ï¼ŒTIME[15:8] ä¸ºç¬¬ 8 ä¸ªå­—èŠ‚ï¼Œå®ƒä»¬æ›¿æ¢äº†å†™å…¥ CAN_TDHxR[31:16]çš„æ•°æ®(DATA6[7:0]å’Œ DATA7[7:0])

AIR32F103ï¼šTIME[7:0] ä½œä¸ºç¬¬ 8 ä¸ªå­—èŠ‚ï¼ŒTIME[15:8] ä¸ºç¬¬ 7 ä¸ªå­—èŠ‚ï¼Œå®ƒä»¬æ›¿æ¢äº†å†™å…¥ CAN_TDHxR[31:16]çš„æ•°æ®(DATA6[7:0]å’Œ DATA7[7:0])

è§£å†³æ–¹æ³•ï¼š

å…¶ä»–CANèŠ‚ç‚¹ä½¿ç”¨æ¥å—åˆ°çš„æ—¶é—´æˆ³æ—¶ï¼Œè½¯ä»¶è¿›è¡Œç¿»è½¬

### TXFP ä¸º 1 æ—¶ï¼ŒFIFO ä¼˜å…ˆçº§å·®å¼‚

ç”±äºè®¾è®¡ä¸åŒï¼ŒAIR32F103 é…ç½® TXFP ä¸º 1ï¼Œå½“æœ‰å¤šä¸ªæŠ¥æ–‡ç­‰å¾…å‘é€æ—¶ï¼ŒæŠ¥æ–‡å‘é€çš„ä¼˜å…ˆçº§å’Œ SXX32F103 ä¸åŒ

SXX32F103ï¼šTXFP ä¸º 1 æ—¶ï¼Œå¤šä¸ªæŠ¥æ–‡ç­‰å¾…å‘é€æ—¶ï¼ŒæŠ¥æ–‡å‘é€çš„é¡ºåºç”±è¯·æ±‚çš„é¡ºåºå†³å®š

AIR32F103ï¼šTXFP ä¸º 1 æ—¶ï¼Œå¤šä¸ªæŠ¥æ–‡ç­‰å¾…å‘é€æ—¶ï¼ŒæŠ¥æ–‡å‘é€çš„é¡ºåºç”±é‚®ç®±å·ä¼˜å…ˆçº§çš„é¡ºåºå†³å®šã€‚  
é‚®ç®±å·ä¼˜å…ˆçº§ï¼šé‚®ç®±å· 0 > é‚®ç®±å· 1 > é‚®ç®±å· 2

## FLASH

### FLASHå†™ä¿æŠ¤ç¬¬ä¸€å—åï¼Œç¬¬ä¸€æ¬¡æ“¦é™¤å…¶ä»–Pageï¼Œç°è±¡å·®å¼‚

SXX32F103ï¼šå†™ä¿æŠ¤ç¬¬ä¸€å—åï¼Œæ“¦é™¤å…¶ä»–Pageï¼Œå¯æ­£å¸¸æ“¦é™¤

AIR32F103ï¼šå†™ä¿æŠ¤ç¬¬ä¸€å—åï¼Œç¬¬ä¸€æ¬¡æ“¦é™¤å…¶ä»–Pageï¼Œæ“¦é™¤å¤±è´¥ï¼Œå¹¶ä¸ŠæŠ¥WRPRTERRå†™ä¿æŠ¤é”™è¯¯

è§£å†³æ–¹æ³•ï¼š

åœ¨é…ç½®Pageæ“¦é™¤ä¹‹å‰ï¼Œå…ˆé…ç½®ä¸€æ¬¡Strtï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º

![flashä»£ç ](img/flash.png)

### è°ƒç”¨ FLASH_EraseOptionBytes()æ¥å£æ“¦é™¤é€‰é¡¹å­—èŠ‚æ—¶æœ‰æ¦‚ç‡ Fault

ç¨‹åºä¸­ä½¿ç”¨ FLASH_EraseOptionBytes()æ¥å£è¿›è¡Œæ“¦é™¤é€‰é¡¹å­—èŠ‚åŒºæ—¶ï¼Œæœ‰æ¦‚ç‡è¿› HardFault_Handler å¼‚å¸¸ä¸­æ–­

è§£å†³æ–¹æ¡ˆï¼š

AIR32F103 å°† FLASH_EraseOptionBytes()æ¥å£åšå‡ºä¿®æ”¹ï¼Œä½¿ç”¨`SetStrt()`æ¥å£æ›¿æ¢ä»¥ä¸‹æŒ‡ä»¤ï¼š

```c
//è¿™äº›æ³¨é‡Šæ‰
// FLASH->CR |= CR_OPTER_Set;
// FLASH->CR |= CR_STRT_Set;
// FLASH_WaitForLastOperation(EraseTimeout);
SetStrt();//æ¢æˆè¿™ä¸ªæ¥å£
```

## USART

### æ™ºèƒ½å¡æ¨¡å¼æ— æ—¶é’Ÿè¾“å‡º

SXX32F103ï¼šUSART æ™ºèƒ½å¡æ¨¡å¼æ—¶é’Ÿè¾“å‡ºï¼Œæ— éœ€é…ç½®USART TE(å‘é€ä½¿èƒ½)/RE(æ¥æ”¶ä½¿èƒ½)

AIR32F103ï¼šUSART æ™ºèƒ½å¡æ¨¡å¼æ—¶é’Ÿè¾“å‡ºï¼Œéœ€è¦é…ç½®USART TE(å‘é€ä½¿èƒ½)/RE(æ¥æ”¶ä½¿èƒ½)ï¼Œå¦åˆ™æ— æ—¶é’Ÿè¾“å‡º

é—®é¢˜åŸå› ï¼š

AIR32F103 çš„ USART æ™ºèƒ½å¡æ¨¡å¼çš„æ—¶é’Ÿè¾“å‡ºæ¡ä»¶å’Œ SXX32F103 ä¸åŒï¼Œè¿˜å—å‘é€ä½¿èƒ½ TE æ§åˆ¶

è§£å†³æ–¹æ³•ï¼š

åœ¨åˆå§‹åŒ–USARTæ—¶ï¼Œå°†USART TE(å‘é€ä½¿èƒ½)/RE(æ¥æ”¶ä½¿èƒ½) ä½¿èƒ½  
é…ç½®æ—¶é’Ÿåˆ†é¢‘ã€ä½¿èƒ½æ™ºèƒ½å¡æ¨¡å¼åï¼Œå°†å‘é€ä½¿èƒ½ TE ç½® 1ï¼Œå¯è§£å†³

### ä½¿ç”¨ DMA å‘é€æ•°æ®ï¼Œé€šè¿‡ USART TC æ ‡å¿—ä½åˆ¤æ–­æ•°æ®æ˜¯å¦å…¨éƒ¨å‘é€å®Œæˆæ³¨æ„äº‹é¡¹

ä½¿ç”¨ DMA è¿›è¡Œå‘é€å¤§äº 2Byte æ•°æ®æ—¶ï¼Œé€šè¿‡åˆ¤æ–­ USART TC æ ‡å¿—ä½ï¼Œæ¥ç¡®è®¤æ•°æ®æ˜¯å¦å‘é€å®Œæ¯•ã€‚  
åº”åœ¨é…ç½® DMA å‰ï¼Œå°† TE å…³é—­ï¼›é…ç½®å®Œ DMA åï¼Œå†å°† TE å¼€å¯ï¼Œè¿›è¡Œæ•°æ®å‘é€ã€‚

## SPI/IIS

### IIS åœ¨ä¸»æ¥æ”¶æ¨¡å¼ã€å¹¶ä¸”å¤„äºPCMæ ‡å‡†æ¨¡å¼ä¸‹æ—¶ï¼Œå…³é—­I2SEç°è±¡å·®å¼‚

SXX32F103ï¼šå¯é€šè¿‡é…ç½®I2SEï¼Œåœæ­¢ä¸»æœºè¾“å‡ºæ—¶é’Ÿ

AIR32F103ï¼šä¸å¯é€šè¿‡é…ç½®I2SEï¼Œåœæ­¢ä¸»æœºè¾“å‡ºæ—¶é’Ÿ

è§£å†³æ–¹æ³•ï¼š

1. é€šè¿‡é…ç½®I2SMODï¼Œåœæ­¢ä¸»æœºè¾“å‡ºæ—¶é’Ÿ
2. é€šè¿‡è½¯å¤ä½æ¨¡å—æ–¹å¼ï¼Œåœæ­¢ä¸»æœºè¾“å‡ºæ—¶é’Ÿ

### ä½œä¸º Masterï¼Œå…¨åŒå·¥æ¨¡å¼ä¸‹æ”¶å‘æ•°æ®æ³¨æ„äº‹é¡¹

ä½¿ç”¨ SPI ä½œä¸º Master è¿›è¡Œé€šè®¯æ—¶ï¼Œæ¥æ”¶æ•°æ®å¼‚å¸¸ï¼Œæ¯”å¦‚ï¼š

SPI é…ç½®ä¸º Master ä¸¤çº¿å…¨åŒå·¥æ¨¡å¼ï¼ŒæŒ‰ç…§ä¸‹å›¾è¿›è¡Œæ”¶å‘æ•°æ®æ“ä½œ

```c
//å‘é€Data0 , Datalï¼›ä¸æ“ä½œæ¥æ”¶DR
SPI_I2S_SendData(SPIx,Data0);
while (SPI_12s_GetFlagstatus (SPIxï¼ŒSPI_12S_FLAG_TXE)==RESET);
while (SPr_I2s_cetFlagStatus(SPIx,SPI_12S_FLAG_BSY) == RESET);
SPI_I2S_SendData(SPIx,Datal);
while (SPI_I2s_GetFlagStatus(SPIx,SPI_12S_FLAG_TXE) == RESET);
while (SPr_I2s_cetFlagStatus(SPIx,SPI_12S_FLAG_BSY) == RESET);
//è¯»å–1æ¬¡DRï¼Œå°†ä¹‹å‰æ¥æ”¶åˆ°çš„æ•°æ®æ¸…é™¤
while (SPI_12s_GetFlagStatus (SPIx,SPI_I2S_FLAG_RXNE)== RESET);
SPI_I2S_ReceiveData(SPIx);
//å‘é€æ•°æ®Data2ï¼›å¹¶è¯»å–DR,è·å–æ¥æ”¶çš„æ•°æ®receive
SPI_I2S_SendData(SPIx,Data2);
while (SPI_12s_GetFlagStatus (SPIx,SPI_I2S_FLAG_TXE) ==RESET);
while (SPI_12s_GetFlagStatus (SPIx,SPI_I2s_FLAG_BSY) == RESET);
while (SPI_I2s_GetFlagStatus(SPIxï¼ŒSPI_I2S_FLAG_RXNE) == RESET);
receive = SPI_I2s_ReceiveData (SPIx);
```

AIR32F103 å‘é€ Data2 æ‰€æ¥æ”¶åˆ°çš„æ•°æ® receive æ˜¯å¼‚å¸¸æ•°æ®ã€‚

é—®é¢˜åŸå› ï¼š

AIR32F103 SPI å…·æœ‰ 16Byte æ¥æ”¶ FIFOã€‚ä¸Šè¿°å‘é€ Data0ï¼ŒData1 æ‰€æ¥æ”¶åˆ°çš„æ•°æ®ç¼“å­˜åˆ°äº†æ¥æ”¶ FIFO ä¸­ï¼Œè¯»å– 1 æ¬¡ DR çš„æ“ä½œå¹¶æ²¡æœ‰å°† FIFO ä¸­æ— ç”¨çš„æ•°æ®å…¨éƒ¨æ¸…é™¤ï¼Œå¯¼è‡´åç»­å‘é€ Data2 æ‰€æ¥æ”¶åˆ°çš„æ•°æ®ä¸æ˜¯æœŸæœ›æ•°æ®

è§£å†³æ–¹æ¡ˆï¼š

ä½œä¸º Master æ¯æ¬¡å‘é€æ•°æ®åï¼Œéƒ½è¯»å–ä¸€æ¬¡ DRï¼Œç¡®ä¿ FIFO ä¸­æ— æ®‹ç•™æ•°æ®å¯è§£å†³ã€‚

```c
//å‘é€Data0 , Datalï¼›æ¯æ¬¡å‘æ•°æ®åéƒ½è¯»å–ä¸€æ¬¡DR
SPI_I2S_SendData(SPIx,Data0);
while (SPI_12s_GetFlagStatus (SPIx,SPI_I2S_FLAG_TXE) ==RESET);
while (SPI_12s_GetFlagStatus (SPIx,SPI_I2s_FLAG_BSY) == RESET);
while (SPI_I2s_GetFlagStatus(SPIxï¼ŒSPI_I2S_FLAG_RXNE) == RESET);
SPI_I2S_ReceiveData(SPIx);

SPI_I2S_SendData(SPIx,Data0);
while (SPI_12s_GetFlagStatus (SPIx,SPI_I2S_FLAG_TXE) ==RESET);
while (SPI_12s_GetFlagStatus (SPIx,SPI_I2s_FLAG_BSY) == RESET);
while (SPI_I2s_GetFlagStatus(SPIxï¼ŒSPI_I2S_FLAG_RXNE) == RESET);
SPI_I2S_ReceiveData(SPIx);

//å‘é€æ•°æ®Data2ï¼›å¹¶è¯»å–DR,è·å–æ¥æ”¶çš„æ•°æ®receive
SPI_I2S_SendData(SPIx,Data0);
while (SPI_12s_GetFlagStatus (SPIx,SPI_I2S_FLAG_TXE) ==RESET);
while (SPI_12s_GetFlagStatus (SPIx,SPI_I2s_FLAG_BSY) == RESET);
while (SPI_I2s_GetFlagStatus(SPIxï¼ŒSPI_I2S_FLAG_RXNE) == RESET);
SPI_I2S_ReceiveData(SPIx);
```

### åœ¨ BUSY çŠ¶æ€ä¸‹å…³å¼€ SPE æœ‰æ¦‚ç‡æ— æ³•æ”¶å‘æ•°æ®

æ“ä½œ SPI æ—¶ï¼Œè½¯ä»¶å…³å¼€ SPE æ—¶å¦‚æœæ²¡æœ‰åˆ¤æ–­é BUSY çŠ¶æ€ï¼Œæœ‰æ¦‚ç‡å‡ºç°åç»­æ— æ³•æ­£å¸¸æ”¶å‘æ•°æ®æƒ…å†µã€‚å¦‚ä¸‹æ“ä½œï¼Œå¯ä»¥æ­£å¸¸å‘é€ 0xAAï¼Œæ— æ³•å‘é€ 0x55ï¼š

```c
SPI_I2S_SendData(SPIx,0xAA);
while (SPI_12s_GetFlagStatus (SPIx,SPI_I2s_FLAG_BSY) == RESET);
SPI_Cmd(SPI1,DISABLE);
SPI_Cmd(SPI1,ENABLE);

while (SPI_12s_GetFlagStatus (SPIx,SPI_I2s_FLAG_TXE) == RESET);
SPI_I2S_SendData(SPIx,0x55);
```

é—®é¢˜åŸå› ï¼š

AIR32F103 SPI åœ¨ BUSY çŠ¶æ€ä¸‹ï¼Œè‹¥è¿›è¡Œå…³å¼€ SPEï¼Œåˆ™å…³ SPE åœ¨æ•°æ®å‘é€æ—¶å®Œæˆ(é BUSY çŠ¶æ€ä¸‹)ç”Ÿæ•ˆï¼Œå¼€ SPE åŠ¨ä½œå¿½ç•¥ä¸ç”Ÿæ•ˆ

è§£å†³æ–¹æ¡ˆï¼š

åœ¨å…³ SPE ä¹‹å‰ï¼Œè¦åˆ¤æ–­æ˜¯å¦ä¸º BUSY çŠ¶æ€ï¼›å¤„äºé BUSY çŠ¶æ€ä¸‹ï¼Œæ‰å¯ä»¥å…³é—­ SPE

### SPIä½¿ç”¨DMAä¼ è¾“æ•°æ®

åœ¨SPIä½¿ç”¨DMAä¼ è¾“æ•°æ®æ—¶ï¼Œå»ºè®®`å¤–è®¾DAMä½¿èƒ½`å’Œ`DMAé€šé“ä½¿èƒ½`åŒæ—¶`ENABLE`å’Œ`DISABLE`ã€‚å¦åˆ™å¯èƒ½é‡åˆ°æ¥æ”¶åˆ°æ•°æ®ä¸æ­£ç¡®é—®é¢˜

```c
DMA_Cmd(FLASH_SPI_RX_DMA_CHANNEL, ENABLE);
DMA_Cmd(FLASH_SPI_TX_DMA_CHANNEL, ENABLE);
SPI_I2S_DMACmd (FLASH_SPI_MASTER, SPI_I2S_DMAReq_Tx, ENABLE);
SPI_I2S_DMACmd (FLASH_SPI_MASTER, SPI_I25_DMAReq_Rx, ENABLE);
```

```c
SPI_I2S_DMACmd (FLASH_SPI_MASTER, SPI_I2S_DMAReq_Tx, DISABLE);
SPI_I2S_DMACmd (FLASH_SPI_MASTER, SPI_I25_DMAReq_Rx, DISABLE);
DMA_Cmd(FLASH_SPI_TX_DMA_CHANNEL, DISABLE);
DMA_Cmd(FLASH_SPI_RX_DMA_CHANNEL, DISABLE);
```

### SPI RXEç½®ä½ï¼Œè¯»å–DRåï¼ŒDRä¸­çš„æ•°æ®ä¿ç•™

SXX32F103ï¼šå½“RXEç½®ä½ï¼Œè¯»æ“ä½œå°†è¿”å›æ¥æ”¶ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œå¹¶ä¸”ä¼šå°†DRæ¸…0

AIR32F103ï¼šå½“RXEç½®ä½ï¼Œè¯»æ“ä½œå°†è¿”å›æ¥æ”¶ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œä¸ä¼šå°†DRæ¸…0

è§£å†³æ–¹æ³•ï¼š

ä¸å½±å“æ­£å¸¸æ”¶å‘æ•°æ®

## USB æ¨¡å—

USB é…ç½®ä¸º Slave æ¨¡å¼ï¼ŒHost ç«¯åœ¨çŸ­æ—¶é—´å†…è¿ç»­ä¸‹å‘ä¸åŒç«¯ç‚¹çš„è¯·æ±‚æˆ–è€…åŒä¸€ç«¯ç‚¹ä¸åŒæ–¹å‘çš„è¯·æ±‚ï¼Œæœ‰æ¦‚ç‡å‡ºç°æ­»æœºç°è±¡

é—®é¢˜åŸå› ï¼š

AIR32F103 USB çš„ USB_ISTR(ä¸­æ–­çŠ¶æ€å¯„å­˜å™¨)ä¸­ EP_ID å’Œ DIR æ›´æ–°æœºåˆ¶å’Œ SXX32F103 ä¸åŒ

è§£å†³æ–¹æ¡ˆï¼š

ä¿®æ”¹ CTR_LP()æ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯è§£å†³ï¼›å¹¶ä¸”ä¿®æ”¹åå…¼å®¹ SXX32F103

```c
void CTR_LP(void)
{
////start///////////////////////////////////////////
  uint32_t i = 0;
  uint16_t nstr = 0;
////end///////////////////////////////////////////
  uint32_t wEPVal = 0;
  /* stay in loop while pending ints */
  while (((wIstr = _GetISTR()) & ISTR_CTR) != 0)
  {
////start///////////////////////////////////////////
    for(i=0;i<8;i++)
    {
      nstr = _GetENDPOINT(i);
      if(nstr & (EP_CTE_RX|EP_CTR_TX))
      {
        EPindex = i;
        if(nstr & EP_CTR_RX)
        {
          wIstr |= ISTR_DIR;
        }
        if(nstr & EP_CTR_TX)
        {
          wIstr &= ISTR_DIR;
        }
        break;
      }
    }
    /* extract highest priority endpoint number */
    //EPindex = (uint8_t)(wIstr & ISTR_EP_ID);
////end///////////////////////////////////////////
    if (EPindex == 0)
    {
      /* Decode and service control endpoint interrupt */
      /* calling related service routine */
      /* (Setup0_Process, In0_Process, Out0_Process) */
.......
```

## DMA æ¨¡å—

å½“ DMA æ¨¡å—æœ‰ Channel æ­£åœ¨æ¬è¿æ•°æ®æ—¶ï¼Œä¿®æ”¹å…¶ä»– Channel çš„ CNT å€¼(æ•°æ®ä¼ è¾“æ•°é‡)ï¼Œæœ‰æ¦‚ç‡ä¸ç”Ÿæ•ˆ

é—®é¢˜åŸå› ï¼š
AIR32F103 DMA Channel çš„ CNT(æ•°æ®ä¼ è¾“æ•°é‡)ä¿®æ”¹ç”Ÿæ•ˆæ¡ä»¶å’Œ SXX32F103 ä¸åŒã€‚

è§£å†³æ–¹æ¡ˆï¼š

è½¯ä»¶é¿å… DMA Channel æ­£åœ¨æ¬è¿æ•°æ®æ—¶ï¼Œä¿®æ”¹å…¶ä»– Channel çš„ CNT å€¼(æ•°æ®ä¼ è¾“æ•°é‡)



## I2C

### ä½œä¸º Master å‘é€èµ·å§‹ä½&åœæ­¢ä½æ³¨æ„äº‹é¡¹

é—®é¢˜æè¿°ï¼š

å¦‚ä¸‹å›¾æ‰€ç¤º MH2103C èµ·å§‹ä½ Hold æ—¶é—´(ğ‘¡â„(ğ‘†ğ‘‡ğ´))&åœæ­¢ä½ Hold æ—¶é—´(ğ‘¡ğ‘†ğ‘ˆ(ğ‘†ğ‘‡ğ‘‚))å’Œ SXX32F103
ä¸åŒã€‚
å½“å¯¹ç«¯ä¸º IO æ¨¡æ‹Ÿ Slave æ—¶ï¼Œéœ€è¦ç¡®è®¤å¯¹ç«¯æ˜¯å¦å¯¹ğ‘¡â„(ğ‘†ğ‘‡ğ´)å’Œğ‘¡ğ‘†ğ‘ˆ(ğ‘†ğ‘‡ğ‘‚)æœ‰è¦æ±‚ã€‚

![i2c_master_difference](img/i2c_master_difference.png)

å¯¹äº SXX32F103ï¼š
ğ‘¡â„(ğ‘†ğ‘‡ğ´)å’Œğ‘¡ğ‘†ğ‘ˆ(ğ‘†ğ‘‡ğ‘‚)ç­‰äº SCL çš„é«˜ç”µå¹³æ—¶é—´ã€‚
å¯¹äº MH2103Cï¼š
æ ‡å‡†æ¨¡å¼ä¸‹ğ‘¡â„(ğ‘†ğ‘‡ğ´)&ğ‘¡ğ‘†ğ‘ˆ(ğ‘†ğ‘‡ğ‘‚)ç­‰äº(FREQ*4+8)*ğ‘‡ğ´ğ‘ƒğµ1ã€‚
å¿«é€Ÿæ¨¡å¼ä¸‹ğ‘¡â„(ğ‘†ğ‘‡ğ´)&ğ‘¡ğ‘†ğ‘ˆ(ğ‘†ğ‘‡ğ‘‚)ç­‰äº(FREQ+8)*ğ‘‡ğ´ğ‘ƒğµ1ã€‚

æ ¹æœ¬åŸå› ï¼šè®¾è®¡ä¸åŒã€‚
è§£å†³æ–¹æ¡ˆï¼šè‹¥å¯¹ğ‘¡â„(ğ‘†ğ‘‡ğ´)å’Œğ‘¡ğ‘†ğ‘ˆ(ğ‘†ğ‘‡ğ‘‚)æ—¶é—´æœ‰è¦æ±‚ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ FREQ æˆ–è€…ä¿®æ”¹ APB1 CLK æ¥è°ƒèŠ‚æ—¶é—´ã€‚

## ISPã€ä»¿çœŸå™¨ã€è„±æœºçƒ§å½•å™¨ä½¿ç”¨æ³¨æ„äº‹é¡¹

### ISP å·¥å…·

AIR32F103 æ”¯æŒç›®å‰å¸‚é¢ä¸Šå¸¸ç”¨çš„ ISP å·¥å…·ï¼ŒåŒ…æ‹¬ STMFlashLoader ã€FlyMcuã€STM32CubeProgrammer ç­‰  
**ä¸æ”¯æŒ mcuisp V0.993**

### ä»¿çœŸå™¨

AIR32F103 æ”¯æŒçš„ä»¿çœŸå™¨åŒ…æ‹¬ ST-LINKV2ã€JLINKã€ARM Emulator ç­‰  
**ä¸æ”¯æŒ ST-LINKV3**

### ä½¿ç”¨ Keil.SXX32F1xx_DFP.2.3.0 ç‰ˆæœ¬ä»¥ä¸Šçš„ pack åŒ…æ³¨æ„äº‹é¡¹

ä½¿ç”¨ ULINK2 æˆ–è€… CMSIS-DAP ä»¿çœŸå™¨å¹¶ä¸”ä½¿ç”¨çš„æ˜¯ Keil.SXX32F1xx_DFP.2.3.0 ç‰ˆæœ¬ä»¥ä¸Š(åŒ…å« 2.3.0 ç‰ˆæœ¬)çš„ pack åŒ…æ—¶ï¼Œæ— æ³•ä¸‹è½½ç¨‹åºã€‚ä¸‹è½½æ—¶æç¤ºä¿¡æ¯`Not a genuine ST Device! Abort connection`

è§£å†³æ–¹æ¡ˆï¼š

æ›´æ¢é¡¹ç›®èŠ¯ç‰‡ç±»å‹ï¼Œä»SXX32æ”¹ä¸ºAIR32çš„PACKåŒ…å³å¯

æˆ–è€…å°†è°ƒè¯•å™¨æ›´æ¢ä¸ºST-LINKV2

### ä¸‹è½½å™¨

ç›®å‰æš‚ä¸æ”¯æŒçš„çƒ§å½•å™¨ä¸ºï¼šSmartPRO T9000-PLUSã€XELTEK SUPERPRO 6100N

#### èŠ¯ç‰‡å¤„äºè¯»å†™ä¿æŠ¤çŠ¶æ€ä¸‹çƒ§å½•å¼‚å¸¸

é—®é¢˜æè¿°ï¼š

ä½¿ç”¨æ­£ç‚¹åŸå­ MINIã€æ­£ç‚¹åŸå­ P100 ç­‰è„±æœºçƒ§å½•å™¨ï¼Œå¯¹å·²ç»é…ç½®äº†è¯»å†™ä¿æŠ¤çš„èŠ¯ç‰‡è¿›è¡Œçƒ§å½•æ—¶ï¼Œå‡ºç°çƒ§å½•å¤±è´¥çš„ç°è±¡ã€‚

è§£å†³æ–¹æ¡ˆï¼š

åœ¨å¤±è´¥åï¼Œé‡æ–°ç»™ MCU ä¸Šä¸‹ç”µ/å¤–éƒ¨ Reset å¤ä½ï¼›å†æ¬¡è¿›è¡Œçƒ§å½•å¯çƒ§å½•æˆåŠŸã€‚  
æ³¨æ„ï¼šè‹¥èŠ¯ç‰‡æ˜¯ç©ºç‰‡ï¼Œä½¿ç”¨ä¸Šè¿°çƒ§å½•å™¨ï¼Œä¸ä¼šå‡ºç°çƒ§å½•å¤±è´¥é—®é¢˜

#### ä½¿ç”¨ WizPro200ST8 ç¼–ç¨‹å™¨çƒ§å½•å¤±è´¥

ä½¿ç”¨ WizPro200ST8 ç¼–ç¨‹å™¨å‡ºç°çƒ§å½•å¤±è´¥çš„ç°è±¡ã€‚

è§£å†³æ–¹æ¡ˆï¼š

å°† WizPro200ST8 ç¼–ç¨‹å™¨çš„ Reset ç®¡è„šå’ŒèŠ¯ç‰‡æ–­å¼€ï¼›åªè¿æ¥ VDDã€SWCLKã€SWDIO å¯æ­£å¸¸çƒ§å½•ã€‚
